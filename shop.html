<!DOCTYPE html>
<html class="light" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport"/>
<title>Fishing Gear Shop</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<script id="tailwind-config">
    tailwind.config = {
        darkMode: "class",
        theme: {
            extend: {
                colors: {
                    "primary": "#42b2d7",
                    "background-light": "#f6f7f8",
                    "background-dark": "#121c20",
                    "coin-gold": "#F3E08F",
                    "soft-charcoal": "#3a4045"
                },
                fontFamily: {
                    "display": ["Plus Jakarta Sans", "sans-serif"]
                },
                borderRadius: {
                    "DEFAULT": "0.5rem",
                    "lg": "1rem",
                    "xl": "1.5rem",
                    "full": "9999px"
                },
            },
        },
    }
</script>
<style>
    body {
        font-family: 'Plus Jakarta Sans', sans-serif;
        -webkit-tap-highlight-color: transparent;
    }
    .pixel-art {
        image-rendering: pixelated;
    }
    .soft-shadow {
        box-shadow: 0 10px 25px -5px rgba(66, 178, 215, 0.1), 0 8px 10px -6px rgba(66, 178, 215, 0.05);
    }
    .glass-nav {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
    }
    .dark .glass-nav {
        background: rgba(26, 38, 43, 0.9);
    }
</style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-soft-charcoal dark:text-white min-h-screen flex justify-center items-center">

<!-- Main Container -->
<div class="relative w-full max-w-[450px] h-[90vh] bg-white dark:bg-[#1a262b] flex flex-col shadow-2xl rounded-xl overflow-hidden border border-gray-100 dark:border-gray-800">

    <!-- Header -->
    <header class="sticky top-0 z-50 glass-nav border-b border-gray-100 dark:border-gray-800 px-6 py-4 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-3">
            <button id="backBtn" class="size-9 rounded-full bg-primary/10 flex items-center justify-center text-primary active:scale-95 transition-transform">
                <span class="material-symbols-outlined text-xl">arrow_back_ios_new</span>
            </button>
            <h1 class="text-lg font-extrabold tracking-tight">Gear Shop</h1>
        </div>
        <div class="bg-background-light dark:bg-gray-800 px-3 py-1.5 rounded-full flex items-center gap-2 border border-gray-100 dark:border-gray-700">
            <span class="material-symbols-outlined text-coin-gold text-[18px] fill-1">monetization_on</span>
            <span id="coinText" class="text-sm font-bold">0</span>
        </div>
    </header>

    <!-- Content -->
    <main class="flex-1 overflow-y-auto custom-scrollbar pb-32 px-4 pt-6">
        
        <!-- Equipped Section -->
        <div class="mb-8">
            <h2 class="text-lg font-bold leading-tight px-1 pb-3">Current Gear</h2>
            <div id="equippedContainer">
                <!-- Injected via JS -->
            </div>
            
            <!-- Withdraw Section -->
            <div id="withdrawContainer" class="mb-8"></div>
        </div>

        <!-- Upgrades List -->
        <div class="space-y-6">
            <div class="flex items-center justify-between px-1">
                <h2 class="text-lg font-bold leading-tight">Rod Upgrades</h2>
            </div>
            
            <div id="shopList" class="space-y-4">
                <!-- Injected via JS -->
            </div>

            <!-- Bait Section -->
            <div class="flex items-center justify-between px-1 pt-4">
                <h2 class="text-lg font-bold leading-tight">Consumables</h2>
            </div>
            <div id="baitList" class="space-y-4">
                <!-- Injected via JS -->
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="absolute bottom-0 w-full glass-nav border-t border-gray-100 dark:border-gray-800 px-6 py-3 flex items-center justify-around z-40">
        <button onclick="window.location.href='index.html'" class="flex flex-col items-center gap-1 group w-16">
            <span class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">home</span>
            <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 group-hover:text-primary">Home</span>
        </button>
        <button class="flex flex-col items-center gap-1 group w-16">
            <div class="size-12 -mt-8 bg-primary rounded-full flex items-center justify-center shadow-lg shadow-primary/40 border-4 border-white dark:border-[#1a262b]">
                <span class="material-symbols-outlined text-white">storefront</span>
            </div>
            <span class="text-[10px] font-bold uppercase tracking-widest text-primary">Shop</span>
        </button>
        <button onclick="window.location.href='inventory.html'" class="flex flex-col items-center gap-1 group w-16">
            <span class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">backpack</span>
            <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400 group-hover:text-primary">Bag</span>
        </button>
    </nav>

</div>

<script src="GameState.js"></script>
<script>
    // --- DOM Elements ---
    const coinText = document.getElementById('coinText');
    const shopList = document.getElementById('shopList');
    const baitList = document.getElementById('baitList');
    const equippedContainer = document.getElementById('equippedContainer');
    const withdrawContainer = document.getElementById('withdrawContainer');
    const backBtn = document.getElementById('backBtn');

    function updateUI() {
        coinText.innerText = (GameState.getCoins() || 0).toLocaleString();
        renderEquipped();
        renderShop();
        renderBait();
        renderWithdraw();
    }

    function renderEquipped() {
        const rod = GameState.getEquippedRod();
        equippedContainer.innerHTML = `
            <div class="p-5 rounded-2xl bg-white dark:bg-gray-800 soft-shadow border border-primary/10 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 size-24 bg-primary/5 rounded-full blur-2xl"></div>
                <div class="flex gap-5 items-center relative z-10">
                    <div class="w-20 h-20 bg-primary/10 rounded-xl flex items-center justify-center border border-primary/5 relative shrink-0">
                        <span class="material-symbols-outlined text-4xl ${rod.color}">${rod.icon}</span>
                        <div class="absolute -bottom-2 -right-2 bg-green-500 text-white text-[9px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wider shadow-sm">Active</div>
                    </div>
                    <div class="flex-1 min-w-0">
                        <p class="text-primary text-[10px] font-extrabold uppercase tracking-widest mb-0.5">Equipped</p>
                        <h3 class="text-lg font-bold mb-1 truncate dark:text-white">${rod.name}</h3>
                        <div class="flex items-center gap-3 text-gray-500 dark:text-gray-400 text-xs">
                            <div class="flex items-center gap-1">
                                <span class="material-symbols-outlined text-[14px]">bolt</span>
                                <span>+${rod.power}% Power</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderWithdraw() {
        const coins = GameState.getCoins();
        const threshold = 50000;
        const canWithdraw = coins >= threshold;
        
        withdrawContainer.innerHTML = `
            <div class="p-4 rounded-2xl bg-gradient-to-br from-gray-900 to-gray-800 text-white shadow-lg relative overflow-hidden">
                <div class="absolute right-0 top-0 p-3 opacity-10">
                    <span class="material-symbols-outlined text-6xl">account_balance_wallet</span>
                </div>
                <div class="relative z-10">
                    <h3 class="text-sm font-bold uppercase tracking-wider text-gray-400 mb-1">Wallet Balance</h3>
                    <div class="flex items-baseline gap-1 mb-4">
                        <span class="text-2xl font-extrabold text-coin-gold">${coins.toLocaleString()}</span>
                        <span class="text-xs text-gray-400">Coins</span>
                    </div>
                    
                    <button onclick="handleWithdraw()" ${!canWithdraw ? 'disabled' : ''} 
                        class="w-full py-3 rounded-xl font-bold text-sm flex items-center justify-center gap-2 transition-all
                        ${canWithdraw ? 'bg-coin-gold text-gray-900 hover:bg-yellow-400 active:scale-95 shadow-md' : 'bg-gray-700 text-gray-500 cursor-not-allowed'}">
                        <span class="material-symbols-outlined text-[18px]">currency_exchange</span>
                        ${canWithdraw ? 'Withdraw to TON' : `Min. ${threshold.toLocaleString()} to Withdraw`}
                    </button>
                </div>
            </div>
        `;
    }

    function renderShop() {
        shopList.innerHTML = '';
        GameConfig.rods.forEach(rod => {
            if (rod.id === GameState.getEquippedRodId()) return; // Don't show equipped rod in shop list

            const isOwned = GameState.getOwnedRods().includes(rod.id);
            const canAfford = GameState.getCoins() >= rod.price;
            
            const card = document.createElement('div');
            card.className = `flex flex-col rounded-2xl bg-white dark:bg-gray-800 shadow-sm border border-transparent p-4 transition-all ${!isOwned && !canAfford ? 'opacity-70' : ''}`;
            
            let btnHTML = '';
            if (isOwned) {
                btnHTML = `
                    <button onclick="equipRod('${rod.id}')" class="flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-5 py-2 rounded-xl font-bold text-xs shadow-sm active:scale-95 transition-transform">
                        <span>Equip</span>
                    </button>
                `;
            } else {
                if (canAfford) {
                    btnHTML = `
                        <button onclick="buyRod('${rod.id}')" class="flex items-center gap-2 bg-primary text-white px-5 py-2 rounded-xl font-bold text-xs shadow-md active:scale-95 transition-transform hover:bg-primary/90">
                            <span class="material-symbols-outlined text-[16px]">payments</span>
                            ${rod.price.toLocaleString()}
                        </button>
                    `;
                } else {
                    btnHTML = `
                        <button class="flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-400 px-5 py-2 rounded-xl font-bold text-xs cursor-not-allowed">
                            <span class="material-symbols-outlined text-[16px]">lock</span>
                            ${rod.price.toLocaleString()}
                        </button>
                    `;
                }
            }

            card.innerHTML = `
                <div class="flex gap-4">
                    <div class="w-16 h-16 bg-background-light dark:bg-gray-900/50 rounded-xl flex items-center justify-center border border-gray-100 dark:border-gray-700 shrink-0">
                        <span class="material-symbols-outlined text-3xl ${rod.color}">${rod.icon}</span>
                    </div>
                    <div class="flex flex-col flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="text-sm font-bold dark:text-white truncate">${rod.name}</h4>
                            ${rod.power > 0 ? `<span class="text-[10px] font-bold text-primary bg-primary/10 px-2 py-0.5 rounded-full shrink-0">+${rod.power}% Power</span>` : ''}
                        </div>
                        <p class="text-gray-500 dark:text-gray-400 text-xs mt-0.5 line-clamp-2">${rod.desc}</p>
                        <div class="mt-3 flex justify-end">
                            ${btnHTML}
                        </div>
                    </div>
                </div>
            `;
            shopList.appendChild(card);
        });
    }

    function renderBait() {
        baitList.innerHTML = '';
        GameConfig.baits.forEach(bait => {
            const canAfford = GameState.getCoins() >= bait.price;
            
            const card = document.createElement('div');
            card.className = "flex flex-col rounded-2xl bg-white dark:bg-gray-800 shadow-sm border border-transparent p-4";
            
            let btnHTML = '';
            if (canAfford) {
                btnHTML = `
                    <button onclick="buyBait('${bait.id}')" class="flex items-center gap-2 bg-green-500 text-white px-5 py-2 rounded-xl font-bold text-xs shadow-md active:scale-95 transition-transform hover:bg-green-600">
                        <span class="material-symbols-outlined text-[16px]">add_shopping_cart</span>
                        ${bait.price}
                    </button>
                `;
            } else {
                btnHTML = `
                    <button class="flex items-center gap-2 bg-gray-100 dark:bg-gray-700 text-gray-400 px-5 py-2 rounded-xl font-bold text-xs cursor-not-allowed">
                        <span class="material-symbols-outlined text-[16px]">lock</span>
                        ${bait.price}
                    </button>
                `;
            }

            card.innerHTML = `
                <div class="flex gap-4">
                    <div class="w-16 h-16 bg-orange-50 dark:bg-orange-900/20 rounded-xl flex items-center justify-center border border-orange-100 dark:border-orange-800/30 shrink-0">
                        <span class="material-symbols-outlined text-3xl text-orange-500">${bait.icon}</span>
                    </div>
                    <div class="flex flex-col flex-1 min-w-0">
                        <div class="flex justify-between items-start">
                            <h4 class="text-sm font-bold dark:text-white">${bait.name}</h4>
                            <span class="text-[10px] font-bold text-orange-500 bg-orange-100 dark:bg-orange-900/30 px-2 py-0.5 rounded-full">Owned: ${GameState.getBaitCount()}</span>
                        </div>
                        <p class="text-gray-500 dark:text-gray-400 text-xs mt-0.5">${bait.desc}</p>
                        <div class="mt-3 flex justify-end">
                            ${btnHTML}
                        </div>
                    </div>
                </div>
            `;
            baitList.appendChild(card);
        });
    }

    // --- Actions ---
    window.buyRod = async function(id) {
        if (await GameState.buyRod(id)) updateUI();
    };

    window.equipRod = async function(id) {
        if (await GameState.equipRod(id)) updateUI();
    };

    window.buyBait = async function(id) {
        if (await GameState.buyBait(id)) updateUI();
    };

    window.handleWithdraw = async function() {
        const result = await GameState.withdrawCoins();
        if (result.success) {
            alert("Withdrawal request submitted successfully!");
            updateUI();
        } else {
            alert(result.error || "Withdrawal failed.");
        }
    };

    backBtn.addEventListener('click', () => {
        window.location.href = 'index.html';
    });

    // Init
    setTimeout(updateUI, 500);

</script>
</body>
</html>
